---
title: "hw1"
output: html_document
author: "Matej Popovski"
date: "`r Sys.Date()`"
---

```{r, echo = FALSE}
knitr::opts_chunk$set(warnings = FALSE, message = FALSE)
```


```{r}
#install.packages("nycflights13")

library(nycflights13)
library(dplyr)
```

```{r}
# [NYC Flights] a)
flights_speed <- flights |> 
  select(carrier, air_time, distance) |> 
  mutate(speed = distance / (air_time / 60))  # Convert air_time to hours

head(flights_speed)  # Check the first few rows

```


```{r}
# [NYC Flights] b)
library(ggplot2)

ggplot(flights_speed, aes(x = carrier, y = speed)) +
  geom_boxplot() +
  labs(title = "Variation in Flight Speed Across Carriers",
       x = "Carrier",
       y = "Speed (miles per hour)") +
  theme_minimal()

```

> There is no large variance in the flight speeds accross carriers.


```{r}
# [London Olympics] a)

library(tidyverse)

# Load the dataset
olympics <- read_csv("https://uwmadison.box.com/shared/static/rzw8h2x6dp5693gdbpgxaf2koqijo12l.csv")

# Compute average age per sport
age_summary <- olympics |> 
  group_by(Sport) |> 
  summarize(avg_age = mean(Age, na.rm = TRUE))

# Plot
ggplot(olympics, aes(x = Sport, y = Age)) +
  geom_jitter(alpha = 0.3, color = "blue", width = 0.2) +  # Individual ages
  geom_point(data = age_summary, aes(x = Sport, y = avg_age), color = "red", size = 3) +  # Average age
  coord_flip() +  # Flip for better readability
  labs(title = "Athlete Ages Across Sports in the 2012 London Olympics",
       x = "Sport",
       y = "Age") +
  theme_minimal()

```

```{r}
# [London Olympics] b)

sorted_sports <- age_summary |> 
  arrange(avg_age)

print(sorted_sports)

```

```{r}
# Not required but for better understanding:

ggplot(sorted_sports, aes(x = reorder(Sport, avg_age), y = avg_age)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(title = "Average Age of Athletes by Sport",
       x = "Sport",
       y = "Average Age") +
  theme_minimal()

```

> Question: Do male and female athletes have different average ages in certain sports? Why?

```{r}
# [London Olympics] c)

# Compute average age by Sport and Gender
age_gender_summary <- olympics |> 
  group_by(Sport, Sex) |> 
  summarize(avg_age = mean(Age, na.rm = TRUE))

# Visualization
ggplot(age_gender_summary, aes(x = reorder(Sport, avg_age), y = avg_age, fill = Sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip() +
  labs(title = "Comparison of Average Age Between Male and Female Athletes by Sport",
       x = "Sport",
       y = "Average Age",
       fill = "Gender") +
  theme_minimal()


```

> Some sports may require more experience (e.g., equestrian), while others favor younger athletes (e.g., gymnastics).

> I can se bigger difference in the average age in equestrian and cycling - mountain bile, cycling - road, cycling track, and the reason behind that might be the differences in peak performance age. Another reason might be career longevity & injury risks. However, overall there are no major differences in the average ages between males and females in different sports.


```{r}
# [Pokemon] a)

library(tidyverse)

pokemon <- read_csv("https://uwmadison.box.com/shared/static/hf5cmx3ew3ch0v6t0c2x56838er1lt2c.csv")

# Create the attack-to-defense ratio column
pokemon <- pokemon %>%
  mutate(attack_defense_ratio = Attack / Defense)

head(pokemon)
```

```{r}
# [Pokemon] b)

median_ratios <- pokemon %>%
  group_by(type_1) %>%
  summarize(median_ratio = median(attack_defense_ratio, na.rm = TRUE)) %>%
  arrange(desc(median_ratio))

head(median_ratios)
```

```{r}
# [Pokemon] c)

# Convert type_1 to a factor with levels ordered by median ratio
pokemon <- pokemon %>%
  mutate(type_1 = factor(type_1, levels = median_ratios$type_1))

# Plot attack vs defense with faceting by type_1
ggplot(pokemon, aes(x = Defense, y = Attack, color = type_1)) +
  geom_point(alpha = 0.6) +
  facet_wrap(~type_1, scales = "free") +
  theme_minimal() +
  labs(title = "Attack vs. Defense by Pokemon Type",
       x = "Defense",
       y = "Attack") +
  theme(legend.position = "none")

```

# [Pokemon] d)

A dynamic visualization would enable users to interact with the data to filter, highlight, or compare Pokémon types.

Potential Questions:
- How do Pokémon types compare in attack-to-defense ratio? Users can select a type from a dropdown to highlight it.
- What are the strongest defensive and offensive Pokémon? Sliders can filter by attack or defense stats.
- How do Legendary Pokémon compare to non-Legendary ones? A toggle can highlight only Legendary Pokémon.

Structure of Interaction:

Dropdown Menu: Highlight a specific Pokémon type.
Sliders: Filter by Attack, Defense, or attack-to-defense ratio.
Hover Tooltips: Display stats (e.g., name, attack, defense) on hover.
Checkbox Toggle: Compare Legendary vs. non-Legendary Pokémon.

How the Display Updates:
- Selecting a Pokémon type highlights it, with others becoming transparent.
- Sliders dynamically filter Pokémon based on the selected range.
- The plot updates to highlight Legendary Pokémon when toggled.


[Gene Expression Faceting]

```{r}
# [Gene Expression Faceting] a)

library(ggplot2)
library(dplyr)
library(readr)

genes <- read_csv("https://uwmadison.box.com/shared/static/dwzchdtfca33r0f6i055k2d0939onnlv.csv")

ggplot(genes, aes(x = time, y = log1p(value))) +
  geom_point(alpha = 0.3, color = "black") +  # Semi-transparent black points
  facet_wrap(~gene, nrow = 2, ncol = 4) +  # Ensuring correct facet arrangement
  theme_minimal() +
  labs(y = "log(1 + value)", x = "Time") +
  theme(
    strip.background = element_rect(fill = "grey80"),  # Matching facet header style
    strip.text = element_text(face = "bold"),  # Making facet text bold
    axis.title = element_text(face = "bold"),  # Bold axis labels
    panel.grid.major = element_line(color = "grey90"),  # Light grey gridlines
    panel.grid.minor = element_blank()  # Removing minor gridlines
  )

```

[Gene Expression Faceting] b)

Strength of Small Multiples:
One major strength of using small multiples is that they allow for easy comparison across multiple categories (in this case, genes). Since each gene has its own separate panel, it becomes much simpler to observe patterns, trends, and differences without overlapping data points from other genes. This clarity makes it easier to identify trends and anomalies in gene expression over time.

Weakness of Small Multiples:
A notable weakness is that small multiples can become cluttered and difficult to interpret when dealing with a large number of categories. If too many genes were included, the individual panels would shrink, making it harder to discern patterns within each plot. Additionally, if the y-axes are not consistently scaled, comparing expression levels between genes might become misleading.


```{r}
# [Gene Expression Faceting] c)

# Group by gene and rounded time, calculate mean expression value
gene_groups <- genes %>%
  group_by(gene, rounded_time = round(time, 2)) %>%
  summarise(mean_value = mean(value), .groups = "drop")

# Order genes by total expression (LEAST abundant first)
gene_order <- gene_groups %>%
  group_by(gene) %>%
  summarise(total_expression = sum(mean_value)) %>%
  arrange(total_expression) %>%  # Reverse the order
  pull(gene)

# Generate heatmap with wider aspect ratio
ggplot(gene_groups, aes(x = rounded_time, y = factor(gene, levels = gene_order), fill = log1p(mean_value))) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "#1F77B4") +  # Ensure the correct blue gradient
  theme_minimal(base_size = 14) +  
  labs(y = "Gene (Sorted by Expression)", x = "Time (Rounded)", fill = "log(1 + mean_value)") +
  theme(
    axis.text.x = element_text(size = 12, face = "bold"),  
    axis.text.y = element_text(size = 12, face = "bold"),
    axis.title.x = element_text(size = 14, face = "bold"),
    axis.title.y = element_text(size = 14, face = "bold"),
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),
    plot.margin = margin(10, 20, 10, 10)  # Adjust spacing if needed
  ) 

```
# ne e tolku horizontalen grafot kako na slika, gpt neznae da popravi

[Gene Expression Faceting] d)

To modify the small multiples plot from part (a) and overlay the smooth fitted curve, we will:

- Load the fitted_values dataset and merge it with the original genes dataset.
- Overlay a smooth fitted curve (mu) on top of the scatter points.
- Ensure correct styling (matching red curve, transparency, facet grid layout).

```{r}
# Load fitted values (smooth curve predictions)
fitted_values <- read_csv("https://go.wisc.edu/x678hu")

# Merge original data with fitted values
merged_data <- genes %>%
  left_join(fitted_values, by = c("gene", "time"))

# Create small multiples plot with fitted curves
ggplot() +
  geom_point(data = genes, aes(x = time, y = log1p(value)), alpha = 0.3, color = "black") +  # Semi-transparent points
  geom_line(data = fitted_values, aes(x = time, y = log1p(mu)), color = "darkred", size = 1.2) +  # Fitted smooth curves
  facet_wrap(~gene, nrow = 2, ncol = 4) +  # Ensure correct facet arrangement
  theme_minimal() +
  labs(y = "log(1 + value)", x = "Time") +
  theme(
    strip.background = element_rect(fill = "grey80"),  # Matching facet header style
    strip.text = element_text(face = "bold"),  # Making facet text bold
    axis.title = element_text(face = "bold"),  # Bold axis labels
    panel.grid.major = element_line(color = "grey90"),  # Light grey gridlines
    panel.grid.minor = element_blank(),  # Removing minor gridlines
    panel.border = element_rect(color = "black", fill = NA, size = 1.2)  # Adding a thin black border
  )

```

How This Relates to the "Grammar of Graphics": 

Layering:
The geom_point() layer represents raw gene expression data.
The geom_line() layer overlays the fitted curve in red.

Aesthetic Mapping (aes()):
The x-axis (time) and y-axis (log1p(value)) map the data points and fitted values.

Faceting:
facet_wrap(~gene) ensures each gene gets its own panel.

Customization & Clarity:
Color (black for raw points, darkred for fitted curve) enhances readability.
Gridlines & Borders provide a polished appearance.


[Visual Redesign] a)

Here’s one of the visualizations I previously created, showing the yearly trends in "THREES Share" and "THREES FG%" for a dataset on shooting splits over several years.

The first plot shows the Yearly Threes Share over time.
The second plot shows the Yearly Threes Made percentage over time.

```{r}

# original code

shoot = read_csv("./Shooting Splits.csv")

mmdata = shoot %>%
        filter(YEAR != 2020) %>%
        rename(THREES_SPLIT = "THREES SHARE", MADE_THREES = "THREES FG%")
mmdata = mmdata %>%
       group_by(YEAR) %>%
       mutate(YEARLY_THREES_SHARE = sum(THREES_SPLIT)/n(), YEARLY_THREES_MADE = sum(MADE_THREES)/n())

ggplot(mmdata, aes(x = YEAR, y = YEARLY_THREES_SHARE)) + 
  geom_point() +
  geom_smooth()

ggplot(mmdata, aes(x = YEAR, y = YEARLY_THREES_MADE)) + 
  geom_point() +
  geom_smooth()

```
The data focuses on shooting performance, with a focus on the percentage of "threes" made and their share in a team’s performance each year. These are scatter plots with smoothing lines.


[Visual Redesign] b) 

Main Takeaways: Both plots show the trend of three-point share and shooting percentage over time. We can infer how the performance has fluctuated yearly. The smoother lines provide a clearer trend despite the variation in individual years.

The Yearly Threes Share plot shows a general upward trend, implying that three-point shooting has become more prevalent over the years.
The Yearly Threes Made plot shows fluctuations, with some years having a steep increase in shooting percentage, possibly pointing to specific player performance improvements.

Intended Message Consistency: The plots communicate the message of how shooting trends have evolved over time. However, they could be made clearer to show year-on-year comparisons of these two metrics in a more comparative way.

Hard-to-Highlight Comparisons: Comparing the two plots side-by-side is difficult when you want to see how the two metrics correlate. It would be better to merge the data for both aspects into a single visualization to compare the trends more easily.


[Visual Redesign] c)  

Legibility of the Original Visualization:

Clarity of Data Points: While scatter plots can be useful, they may be difficult to read if there are too many overlapping points or if the trends aren’t clear enough. Here, the scatter points could be a bit noisy, making it harder to discern specific trends at a glance.

Lack of Comparison: There are two separate plots that display different metrics (threes share and threes made), making it harder to compare them directly.

Aesthetics: The use of scatter points and smoothing lines is fine, but it doesn’t fully highlight the correlation between the two metrics over the years. The two plots could be made more compact for easier comparison.


[Visual Redesign] d)  

Proposed Redesign:
For the redesign, I would propose merging these two visuals into a single plot with both metrics combined and enhanced for legibility and clarity. Here’s how I would proceed with the redesign:

Combine the Metrics into One Plot: Instead of showing two separate plots, I would create a line plot with two different colored lines (one for Yearly Threes Share and one for Yearly Threes Made) to allow for easier comparison.

Legibility Improvements:

Line Plot: Use lines instead of points for clearer trend visibility.
Dual Y-Axes: If the scales for the two metrics differ significantly, using a dual y-axis could make the trends easier to compare while maintaining clarity.
Color Coding: Use different colors to distinguish between the two metrics clearly (e.g., blue for threes share, orange for threes made).
Annotations: Annotate key points where significant changes happen in the trends (e.g., sudden spikes in shooting performance) to give viewers key insights.

```{r}
ggplot(mmdata, aes(x = YEAR)) + 
  geom_line(aes(y = YEARLY_THREES_SHARE, color = "Threes Share"), size = 1) +
  geom_line(aes(y = YEARLY_THREES_MADE, color = "Threes Made"), size = 1) +
  scale_color_manual(values = c("Threes Share" = "blue", "Threes Made" = "orange")) +
  labs(title = "Comparison of Yearly Threes Share and Threes Made",
       x = "Year",
       y = "Percentage (%)",
       color = "Metrics") +
  theme_minimal() +
  theme(legend.position = "bottom") 
```

Key Points in the New Design:

Visual Tasks: The main visual tasks are to highlight the trend over time, compare the yearly performance of the two metrics, and easily spot trends and key points in the data.

Trade-Offs: Using a dual line plot means sacrificing the individual point-level detail that the scatter plot provides. However, this trade-off enhances clarity in showing the overall trend and comparison between the two metrics.

Legibility Improvements:

Using line plots instead of scatter plots for smoother trend visualization.
The addition of color and dual y-axes makes it easier to distinguish between the two metrics.
The legend is moved to the bottom for clarity, making the plot less cluttered.



[California Wildfire Alternatives] 




























